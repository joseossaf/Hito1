<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="José Ossa">

<title>Hito 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Plantilla_files/libs/clipboard/clipboard.min.js"></script>
<script src="Plantilla_files/libs/quarto-html/quarto.js"></script>
<script src="Plantilla_files/libs/quarto-html/popper.min.js"></script>
<script src="Plantilla_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Plantilla_files/libs/quarto-html/anchor.min.js"></script>
<link href="Plantilla_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Plantilla_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Plantilla_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Plantilla_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Plantilla_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hito 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>José Ossa </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="descripción-activo-y-contexto-hito-1" class="level2">
<h2 class="anchored" data-anchor-id="descripción-activo-y-contexto-hito-1">Descripción Activo y Contexto (Hito 1)</h2>
<section id="definición" class="level3">
<h3 class="anchored" data-anchor-id="definición">Definición</h3>
<p>El activo del sector de la banca que se eligió fue la acción del Banco de Chile (CHILE). El Banco de Chile, fundado en 1893, es una reconocida institución financiera en Chile la cual tiene una gran historia de operaciones y presenta una reconocida presencia en el mercado financiero del país, logrando demostrar ser una entidad sólida y estable, que ofrece una amplia variedad de produtos y servicios financieros.</p>
<p>Este activo, y un activo de la banca chilena en general, es relevante estudiar ya que hay un estudio disponible en la Web Of Science que analiza los efectos de los bancos internacionales en el rendimiento de los bancos chilenos. El artículo, llamado “Institutional development and foreign banks in Chile”, que tiene una calificación Q1, dice que los bancos internacionales mejoran la competitividad en la bancada de países en desarrollo. Al mismo tiempo, éstos reducen la volatilidad en los retornos y aumentan los créditos de consumo.</p>
</section>
<section id="motivación" class="level3">
<h3 class="anchored" data-anchor-id="motivación">Motivación</h3>
<p>La elección de este activo se debe a una serie de razones que hacen que su estudio sea relevante para mí. En primer lugar, y como se mencionó anteriormente, el Banco de Chile es una de las instituciones financieras más grandes del país, lo que demuestra que es una institución sólida y que ha logrado mantener su reputación incluso en condiciones económicas adversas, como por ejemplo, la Pandemia. Hace unos meses, tuve la oportunidad de entrevistar al Tesoreso del Banco de Chile, Sergio Karlezi, en donde me contó las estrategias implementadas en la Pandemia del Covid-19, y hablamos del los superiores retornos en comparación a los otras bancos, por lo que también es de mi interés estudiar este activo.</p>
<p>Otra motivación, y que también se hablo en la entrevista con Sergio, es que el Chile funciona como Banco y su modelo de negocios está enfocado en el cliente. Esto lo respalda un reciente reconocimiento en el ranking PXI - Praxis Xperience Index, donde el Chile fue reconocido como “la más destacada en experiencia de clientes”. Esto lo diferencia de los otros bancos agregando valor y logrando captar nuevos clientes.</p>
<p>Finalmente, y esta ya es una motivación más personal, escogí este activo porque voy a realizar la práctica profesional en el Banco de Chile, por lo que creo que es una buena instancia para aprender sobre la institución.</p>
</section>
<section id="contexto" class="level3">
<h3 class="anchored" data-anchor-id="contexto">Contexto</h3>
<p>El contexto financiero del Chile será útil para comprender tanto su posición como el desempeño en el mercado. En esta parte del trabajo se hará una descripción estadística de la acción, como también se analizará una variable económica relevante para el estudio.</p>
<p><img src="photos/Captura%20de%20Pantalla%202023-09-27%20a%20la(s)%2023.01.56.png" class="img-fluid"></p>
<p>Gráfico 1: Historial de precios últimos 5 años.</p>
<p>El Gráfico 1 muestro el precio histórico de la acción en un periodo de 5 años. Podemos identificar que a principios del segundo semestre del 2019, la acción rondaba los $105, sin embargo, la primera caída significativa que se logra identificar es en octubre del 2019, la crisis social. Podemos ver que el precio de la acción continuó disminuyendo producto de la crisis sanitaria, periodo en el que llegó a su mínimo histórico ($57,15). Desde ese entonces, la accón ha logrado repuntar alcanzando, al día de hoy, un precui de $90,15 por acción.</p>
<p>Hay ciertos riesgos que hay que tener presentes a la hora de invertir en un activo de este tipo. A continuación hablaré sobre algunos, explicando el efecto sobre el precio de la acción. En primer lugar está el Riesgo de Mercado, que hace referencia a que el precio de la acción oscile dada ciertas condiciones en el marcado, como por ejemplo, eventos económicos globales, lo que puede provocar una disminución en el valor del activo. Al ser un banco, el activo está expuesto al Riesgo Crediticio, de tal manera que el incumplimiento de distintas obligaciones pueden afectar negativamente el precio de la acción. Otro riesgo súper importante en la industria es el Riego de Tasa de Interés, de tal manera que si hay un aumento inesperado en la tasa de interés, esto puede provocar que hayan menores rendimientos, afectando la calidad del activo.</p>
<p>Las rentabilidades del Chile en los últimos 5 años se muestran en la tabla a continuación.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="photos/Captura%20de%20Pantalla%202023-09-28%20a%20la(s)%2014.32.20.png" class="img-fluid figure-img" width="240"></p>
</figure>
</div>
<p>Tabla 1: Rentabilidades anuales CHILE</p>
<p>Como muestra la Tabla 1, y complementando con el Gráfico 1, el 2019 la acción tubo una rentabilidad anual negativa, la que se debe, principalmente, a los eventos ocurridos en octubre de ese año, lo que produjo inestabilidad económica, afectante fuertemente el precio de la acción. En el año 2020 el mercado se vió afectado por la Pandemia, sin embargo, a pesar de la volatilidad en el primer semestre y el tema político, la acción tuvo un rendimiento anual muy poco negativo, lo que se interpreta que el banco logró adaptarse a las condiciones de la coyuntura, lo que no tuvo efectos considerables. El 2021 también el mercado estaba influenciado por el Covid-19, aunque en menor medida que el año anterior. La principal razón de su rendimiento anual negativo es debido a la continuación del Covid-19 y los efectos económicos producidor por las Políticas Fiscales implementadas en la pandemia, así como también aumento en las tasas de interés, entre otros factores. Respecto al 2022, se identifica un cambio significativo respecto a los años anteriores, alcanzando una extraordinaria rentabilidad anual del 36,69%. Las razones del resultado son principalmente las condiciones económicas en Chile, hay mayor confianza en los inversionistas y un eventual crecimiento en la actividad bancaria. Por último, el año en curso lleva una rentabilidad del 17,24%, que se debe, principalmente, a la recuperación económica.</p>
<p>Las tasas de interés influyen directamente tanto en el funcionamiento como en el desempeño del banco. Es por esto que esta será la variable que se analizará brevemente, y que sin dudas, tiene repercusiones en el valor de la acción del Chile.</p>
<p>En primer lugar, las tasas de interés influyen en el margen de interés neto de los bancos. Cuando las tasas aumentan, los bancos cobran más, pero, al mismo tiempo, el banco ofrece una tasa más alta en los depósitos a plazo. Además, cuando las tasas son más altas, es probable que los prestatarios no pidan financiamiento al banco (o menos de lo pensado), lo que se traduce en una reducción de los ingresos por intereses. Finalmente, la tasa de interés influye en la valoración de activos, de tal manera que tasas más altas reducen el valor de los bonos que tiene el banco, afectando directamente el valor de los activos de éste.</p>
<p><img src="photos/Captura%20de%20Pantalla%202023-09-28%20a%20la(s)%2018.50.34.png" class="img-fluid"></p>
<p>Gráfico 2: Rentabilidades Bancos.</p>
<p>El Gráfico 2 muestra las rentabilidades en el periodo octubre 2021 - octubre 2023, donde la línea negra representa al Banco de Chile, la morada al Banco Santander, la amarilla al BCI y la celeste representa el Banco Itaú. Como se logra ver en el gráfico de arriba, notamos que todos los bancos, menos el Chile, tienen más menos la misma tendencia a igual nivel de rentabilidad, sin embargo, el Banco de Chile, fluctua distinto a los otros bancos en comparación y éste de demuestra tener una mayor rentabilidad acumulada en el periodo mencionado anteriormente.</p>
</section>
<section id="análisis-de-largo-plazo" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-largo-plazo">Análisis de Largo Plazo</h3>
<section id="caracterización-deuda-aplicación-cap.-15" class="level4">
<h4 class="anchored" data-anchor-id="caracterización-deuda-aplicación-cap.-15">Caracterización deuda (Aplicación cap. 15)</h4>
<p>El Banco de Chile tiene distintas maneras de inversión. En primer lugar, y lo más conocido por las personas, es la inversión a través de los préstamos y créditos, como créditos de consumo, hipotecarios o comerciales. Como se mencionó anteriormente, el banco genera ingresos con los intereses asociados a dichos productos. Además, el Banco de Chile tiene inversiones en acciones de otras empresas, las que generan dividendos y ganancia de capital para el banco. Por otro lado, el Chile utiliza derivados con el objetivo de gestionar el riesgo de mercado.</p>
</section>
<section id="caracterización-de-emisiones-históricas-aplicación-cap.-20" class="level4">
<h4 class="anchored" data-anchor-id="caracterización-de-emisiones-históricas-aplicación-cap.-20">Caracterización de emisiones históricas (Aplicación cap. 20)</h4>
<p>Actualmente, el Banco de Chile tiene 101.017.081.114 acciones en circulación. A lo largo del tiempo, el Chile ha realizado emisión de acciones más de 30 veces. La última emisión de acciones fue en el 2018, donde se emitieron 1.572.948.922 nuevas acciones. El 22 de marzo de 2018 se realizó una Junta Extraordinaria de Accionistas, donde el objetivo de la convocatoria era aumentar el capital del banco capitalizando el 40% de la utilidad líquida distribuible correspondiente al ejercicio 2017 mediante la emisión de acciones liberadas de pago sin valor nominal, a un precio de $93,73 por acción y distribuidas entre los accionistas a razón de 0,02238030880 acciones liberadas de pago por cada acción.</p>
<p>El proceso de emisión en sí comienza en la referida Junta Extraordinaria de Accionistas, en la cual se acuerda aumentar el capital del banco mediante la emisión de una cantidad definida de nuevas acciones. Posteriormente la Superintendencia de Bancos e Instituciones Financieras es la encargada de aprobar la reforma de estatutos, que queda inscrita en el Registro de Comercio de Santiago y es publicada en el Diario Oficial. En este punto la emisión de acciones está inscrita en el Registro de Valores de la Superintendencia. Posterior a lo anterior, el Directorio del Banco de Chile fija una fecha para la emisión y distribución de las respectivas acciones. El directorio informa la razón del derecho a suscripción por acción.Luego de esto, viene el paso de Estabilización del mercado (visto en clases). La información antes mencionada se obtuvo desde la página web del Banco de Chile, en la sección Inversionistas/Junta de accionistas, y luego en el documendo “Junta Accionistas Presentación 2018”.</p>
</section>
<section id="relación-con-activos-derivados" class="level4">
<h4 class="anchored" data-anchor-id="relación-con-activos-derivados">Relación con activos derivados</h4>
<p>El Banco de Chile tiene contratos de instrumentos financieros derivados con el objetivo de proteger la exposición al riesgo cambiaro y al riesgo de tasa de interés.</p>
<p>En los estados financieros están presentes los Contratos de Derivados de Negociación, como Forwards, Swaps, Opciones Call, Opciones Put y Futuros. Como solo se pide hablar sobre uno de estos derivados, desarrollaré un poco los Forwards. “Un Forward es un contrato entre dos partes para comprar o vender un activo subyacente en un determinado precio y fecha”. Estos contratos son utilizados con el objetivo de cubrir el riesgo al cambio de precios de activos.</p>
</section>
</section>
<section id="reporte-grupal" class="level3">
<h3 class="anchored" data-anchor-id="reporte-grupal">Reporte grupal</h3>
<p>En relación a los activos considerados por el grupo, se debe tomar la desición de cómo distribuir los porcentajes de cada uno de ellos, con el fin de determinar un portafolio de inversión. Este último se creará en base a ciertos criterios que se comentarán a continuación, con el fin de maximizar los retornos manteniendo la exposición al riesgo lo más controlado posible.</p>
<table class="table">
<thead>
<tr class="header">
<th>Activo</th>
<th>Porcentaje</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CENCOSUD S.A</td>
<td>40%</td>
</tr>
<tr class="even">
<td>CHILE</td>
<td>40%</td>
</tr>
<tr class="odd">
<td>ENELCHILE S.A</td>
<td>20%</td>
</tr>
</tbody>
</table>
<p>Estos porcentajes fueron distribuidos de esta manera, ya que cada activo tiene aspectos favorables como desfavorables pero en relación a la rentabilidad esperada se cree que estos representan un portafolio diversificado correctamente. A continuación se identificarán con mayor precisión los puntos relevantes para la determiunación de los porcentajes en base a cada activo en cuestión.</p>
<p>Para el activo BANCO DE CHILE, se determinó destinar un 40% del portafolio ya que ha demostrado ser el banco con mayores utilidades en comparación a su competencia y destaca por un alto ROE. Además, se espera que siga con tendencia positiva, además de seguir superando a su competencia. Es por esto que se determinó asignar un 40% del portafolio a las acciones del Banco de Chile.</p>
<p>Para el activo CENCOSUD S.A , se determinó destinar un 40% del portafolio a este activo debido a que la empresa ha logrado en el último tiempo estabilizar los resultados en Brasil y Colombia lo que estaba impactando negativamente a la compañía. Por otro lado, el negocio relacionado al retail y supermercados se ha visto en alza lo que representa un mayor ingreso para la compañía y beneficio para el país. Continuando con lo anterior, parece importante destinar un porcentaje a este activo debido a que, en relación a las diversas instituciones de clasificación de riesgo, Cencosud S.A figura como una institución estable lo que atrae nuevos inversionistas y posibles retribuciones en relación a las utilidades de la empresa para ser repartidas tal como lo fueron los dividendos otorgados a los accionistas recientemente.</p>
<p>Para el activo ENEL CHILE S.A, se determinó destinar un menor porcentaje que los otros activos en el portafolio, debido a que esta empresa ha tenido ciertas dificultades en el último tiempo. En primer lugar, se puede identificar la mega sequía que se ha vivido en los últimos años, lo que complica la obtención de energía mediante las hidroelectricas. Esto último, luego de el transcurso del año 2023, se ha visto mejorado por el fenómeno del niño, el cual ha producido una mayor cantidad de precipitaciones generando con ello la recuperación de embalses de acumulación de agua. Lo anterior, beneficia a esta empresa para poder producir energía, pero cabe mencionar que sigue siendo una empresa que representa un mayor riesgo para los inversionistas debido a que se ve afectada por fenómenos naturales incontrolables por el ser humano. Es por este motivo, que parece razonable destinar un porcentaje más cauto con el fin de rentabilizar de mejor manera la inversión controlando de mejor manera la exposición al riesgo.</p>
</section>
<section id="aplicación-black-scholes" class="level3">
<h3 class="anchored" data-anchor-id="aplicación-black-scholes">Aplicación Black-Scholes</h3>
<p>En el marco del análisis del activo seleccionado, se ha llevado a cabo una valoración de una opción para comprar un activo subyacente. Esto permite comprender el valor intrínseco y tener mayor claridad al momento de tomar decisiones, lo que es fundamental para la toma de decisiones en las inversiones.</p>
<p>Con el fin de llevar a cabo esta valorización, se utilizó el modelo de Black-Scholes, herramienta fundamental según la teoría de opciones financieras que se ha posicionado como un estándar aceptado por la industria. Varios parámetros clave deben tenerse en consideración para calcular el valor de la opción.</p>
<p>Para respaldar el proceso de valorización, se implementó un código en R que implementa la fórmula matemática Black-Scholes, tal como se mencionó anteriormente. Para esta implementación, se calculó la volatilidad de los retornos del activo. Se consideró un horizonte de 5 años para determinar dicho valor. Por otro lado, como tasa libre de riesgo se utilizó el retorno de un bono del Banco Central 10 años plazo (6,6%). Para ver el valor actual del activo, se obtiene mediante una función que busca el precio actual del activo en Yahoo Finance. Por último, el tiempo de vencimiento en años se fijó en 6 meses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: xts</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: TTR</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>symbol <span class="ot">&lt;-</span> <span class="st">"CHILE.SN"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Precio actual de CHILE</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>current_price <span class="ot">&lt;-</span> <span class="fu">getQuote</span>(symbol)<span class="sc">$</span>Last</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"El precio actual de la acción del Banco de Chile (CHILE) es:"</span>, current_price, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El precio actual de la acción del Banco de Chile (CHILE) es: 94.25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos desde Yahoo Finance</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(symbol, <span class="at">from =</span> <span class="st">"2018-10-23"</span>, <span class="at">to =</span> <span class="st">"2023-10-24"</span>, <span class="at">src =</span> <span class="st">"yahoo"</span>, <span class="at">adjust =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CHILE.SN"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>chile <span class="ot">&lt;-</span> <span class="fu">Cl</span>(<span class="fu">get</span>(symbol)) <span class="co">#Precios ajustados al cierre</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Retornos diarios</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>retornos <span class="ot">&lt;-</span> <span class="fu">dailyReturn</span>(chile)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Volatilidad</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>volatilidad <span class="ot">&lt;-</span> <span class="fu">sd</span>(retornos, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"La volatilidad basada en los retornos diarios de la acción del Banco de Chile (CHILE) es:"</span>, volatilidad, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>La volatilidad basada en los retornos diarios de la acción del Banco de Chile (CHILE) es: 0.01838212 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parametros función</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(current_price)  <span class="co"># Precio actual acción</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">91</span>                         <span class="co"># Precio  ejercicio</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="fl">0.5</span>                        <span class="co"># Tiempo de vencimiento (en años)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.066</span>                      <span class="co"># Tasa libre de riesgo</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">0.01838212</span>             <span class="co"># Volatilidad de los últimos 5 años </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para calcular el precio de una opción call utilizando el modelo Black-Scholes</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>black_scholes <span class="ot">&lt;-</span> <span class="cf">function</span>(S, K, T, r, sigma) {</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  d1 <span class="ot">&lt;-</span> (<span class="fu">log</span>(S <span class="sc">/</span> K) <span class="sc">+</span> (r <span class="sc">+</span> (sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> T) <span class="sc">/</span> (sigma <span class="sc">*</span> <span class="fu">sqrt</span>(T))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  d2 <span class="ot">&lt;-</span> d1 <span class="sc">-</span> sigma <span class="sc">*</span> <span class="fu">sqrt</span>(T)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calcular el precio de la opción call</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  precio_call <span class="ot">&lt;-</span> S <span class="sc">*</span> <span class="fu">pnorm</span>(d1) <span class="sc">-</span> K <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> T) <span class="sc">*</span> <span class="fu">pnorm</span>(d2)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(precio_call)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular el precio de la opción call</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>precio_call <span class="ot">&lt;-</span> <span class="fu">black_scholes</span>(S, K, T, r, sigma)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"El precio de la opción call es:"</span>, precio_call, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El precio de la opción call es: 6.203991 </code></pre>
</div>
</div>
</section>
<section id="modelo-adicional-de-valorizacion" class="level3">
<h3 class="anchored" data-anchor-id="modelo-adicional-de-valorizacion">Modelo Adicional de valorizacion</h3>
<p>El modelo de valorización alternativo que se utiliza es el Modelo Binomial. Este modelo representa otra opción válida frente al modelo utilizado anteriormente (Black-Scholes) y se sustenta en la idea fundamental de que el valor correspondiente al actuvo subyacente puede variar hacia dos direcciones diferentes a lo largo de cada periodo de tiempo. A pesar de ser más simple que el modelo Black-Scholes, este modelo puede resultar útil cuando las condiciones del mercado no cumplen con todas las suposiciones requeridas por dicho modelo. Con este modelo es posible capturar con mayor flexibilidad las variaciones de volatilidad y otras condiciones del mercado que no se ajustan completamente a las suposiciones del primer modelo.</p>
<p>Es justificable la elección del Modelo Binomial como un modelo alternativo ya que hay un estudio científico disponible en la Web Of Science el cual estudia como los dos modelos son aproximadamente iguales entre sí en un periodo. El estudio determina que la correlación entre la opción de compra y venta utilizando ambos modelos está perfectamente correlacionada positivamente. Además, la prueba estadística t mostró que no hay diferencias significativas entre la opción “call” o “put” usando ambos modelos, con un intervalo de confianza del 95%. El estudio concluye con que no hay una diferencia estadísticamente significativa entre el Modelo Black-Scholes y el Modelo Binomial (Ahmad &amp; N, 2018). Dicho lo anterior, hay una justificación científica para elegir el Modelo Binomial como un modelo alternativo al Modelo Black-Scholes.</p>
</section>
<section id="aplicacion-modelo-adicional" class="level3">
<h3 class="anchored" data-anchor-id="aplicacion-modelo-adicional">Aplicacion modelo adicional</h3>
<p>A continuación, se presentará un código en R Studio en el cual, como se mencionó anteriormente, se usa el Modelo Binomial como modelo de valorización alternativo.</p>
<p>La fórmula matemática aplicada para el modelo alternativo es la siguiente:</p>
<p><img src="Captura%20de%20Pantalla%202023-10-26%20a%20la(s)%2020.24.53.png" class="img-fluid"></p>
<p>Donde C es el precio de la opción, p es la probabilidad implícita de ascendo, (1-p) es la probabilidad implícita de descenso, Cu es el valor de la opción en estado up, mientras que Cd es el valor de la opción en estado down. Por último, Rf corresponde a la tasa libre de riesgo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantmod)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>symbol <span class="ot">&lt;-</span> <span class="st">"CHILE.SN"</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Datos Yahoo Finance</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">getSymbols</span>(symbol, <span class="at">from =</span> <span class="st">"2018-10-23"</span>, <span class="at">to =</span> <span class="st">"2023-10-24"</span>, <span class="at">src =</span> <span class="st">"yahoo"</span>, <span class="at">adjust =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CHILE.SN"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Precio cierre ajustado</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>chile <span class="ot">&lt;-</span> <span class="fu">Cl</span>(<span class="fu">get</span>(symbol))</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Precio actual acción</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>current_price <span class="ot">&lt;-</span> <span class="fu">getQuote</span>(symbol)<span class="sc">$</span>Last</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"El precio actual de la acción del Banco de Chile (CHILE) es:"</span>, current_price, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El precio actual de la acción del Banco de Chile (CHILE) es: 94.25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parámetros función</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>S0 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(current_price)  <span class="co"># Precio actual de CHILE</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="dv">91</span>                          <span class="co"># Precio de ejercicio</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fl">0.066</span>                       <span class="co"># Tasa libre de riesgo </span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">1</span>                           <span class="co"># Tiempo de vencimiento (en años)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1</span>                           <span class="co"># Número de pasos</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fl">1.1</span>                        <span class="co"># Factor de aumento del precio</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fl">0.9</span>                        <span class="co"># Factor de disminución del precio</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Probabilidad de movimiento hacia arriba</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> r <span class="sc">-</span> d) <span class="sc">/</span> (u <span class="sc">-</span> d)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz para almacenar los precios en cada paso del tiempo</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>option_prices <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol =</span> N <span class="sc">+</span> <span class="dv">1</span>, <span class="at">nrow =</span> N <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular los precios de la opción al vencimiento</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>N) {</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  option_prices[N <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">max</span>(S0 <span class="sc">*</span> u<span class="sc">^</span>j <span class="sc">*</span> d<span class="sc">^</span>(N <span class="sc">-</span> j) <span class="sc">-</span> K, <span class="dv">0</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular los precios de la opción hacia atrás en el tiempo</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> N<span class="sc">:</span><span class="dv">1</span>) {</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span>i <span class="sc">-</span> <span class="dv">1</span>) {</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    option_prices[i, j <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> (p <span class="sc">*</span> option_prices[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">1</span>] <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">-</span> p) <span class="sc">*</span> option_prices[i <span class="sc">+</span> <span class="dv">1</span>, j <span class="sc">+</span> <span class="dv">2</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> r)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># El precio de la opción de compra está en la celda (1,1) de la matriz</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>option_price <span class="ot">&lt;-</span> option_prices[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"El precio de la opción utilizando el modelo binomial es:"</span>, option_price, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>El precio de la opción utilizando el modelo binomial es: 2.021341 </code></pre>
</div>
</div>
</section>
<section id="análisis-de-contraste-de-ambos-modelos" class="level3">
<h3 class="anchored" data-anchor-id="análisis-de-contraste-de-ambos-modelos">Análisis de contraste de ambos modelos</h3>
<p>Como se dijo anteriormente, el Modelo Binomial es una buena opción alternativa al momento de hacer una valoción de una opción de un activo. Ambos modelos tienen similitudes y diferencias. El precio de la opción utilizando el Modelo Black-Scholes fue de $3.351904, mientras que utilizando el Modelo Binomial, resultó un precio de $1.510225.</p>
<p>Iniciando con las similitudes de estos modelos, tenemos que ambos son utilizados para valorar opciones financieras. Estos enfoques permiter estimar el precio de una opción en un determinado mercado. En segundo lugar, se tiene que ambos modelos se fundamentas en la premisa de que los precios de los activos subyacentes pueden fluctuar con el tiempo debido a su volatilidad y a la tasa libre de riesgo del mercado. Por último, se tiene la utilización de parámetros fundamentales, como el precio actual del activo, el precio de ejercicio, tasa libre de riesgo, volatilidad, entre otros.</p>
<p>Respecto a las diferencias entre estos modelos, en primer lugar se tiene el métido utilizado para realizar los cálculos. Por una parte, Black-Scholes se basa en una aproximación continua, por otra parte, el Modelo Binomial ofrece un enfoque discreto. Otra diferencia es el resultado de las valoraciones, como se mencionó anteriormente. La explicación de esta diferencia podría explicarse por las supociones y aproximaciones de cada modelo.</p>
</section>
<section id="reporte-grupal-caso-administración" class="level3">
<h3 class="anchored" data-anchor-id="reporte-grupal-caso-administración">Reporte Grupal: Caso Administración</h3>
<p>De acuerdo al caso de administración de efectivo de Braam Industries presente en el libro ROSS, se procedió a resolver este en base a los datos del activo financiero Banco de Chile. Para esto, fue necesario comprender y determinar ciertos valores que se observan en la imagen del archivo excel presentado a continuación.</p>
<p><img src="Captura%20de%20Pantalla%202023-10-26%20a%20la(s)%2020.03.22.png" class="img-fluid"></p>
<p>En primer lugar, se tienen las ventas anuales. Para ello fue necesario investigar en la página del banco cual era el valor de estas, logrando obtener, para el año 2022, un monto de MM$55.255.362 (Banco de Chile, 2022). Posterior a ello, se tuvo que indagar con respecto a la tasa de incumplimiento o morosidad, obteniendo una tasa de 1,32% (CMF, 2023). Luego, se tuvo que realizar el cálculo para determinar los costos administrativos utilizando la fórmula : Total gastos de administración / Ventas anuales (en %), logrando un valor de 0,64%. Finalmente, con estos datos y otros provistos por enunciado, se logró determinar el VPN (valor presente neto) con el fin de determinar cual de las tres opciones es la que otorga un mayor valor. Estas opciones se determinaron en base a los datos propuestos actualmente y luego con estos, a través de la regla de tres, se fue rellenando la tabla hasta obtener lo necesario para realizar el estudio en cuestión.</p>
<p>Con la realización de estos cálculos, se logró determinar que la opción que maximiza el VPN es la opción 1, obteniendo un valor de MM$13.426.115, que se encuentra por sobre las otras 2 opciones disponibles.</p>
<p>Ahora bien, respondiendo a la primera pregunta propuesta por el libro de Ross, la política de crédito que debiese adoptar la empresa es la opción 1, debido a que esta es la que representa un mayor beneficio para la empresa.</p>
<p>Continuando con las preguntas, ahora se tiene que estudiar si es factible que la opción 2 tenga tasa de incumplimiento y costos administrativos mayor a los de la opción 3. Esto, en base a los resultados provistos para el activo estudiado “Banco de Chile” es factible y puede deberse a varios factores tales como:</p>
<p>Mejores prácticas administrativas : La reducción en los costos administrativos podría demostrar que la Opción 2 tiene procedimientos administrativos mejor optimizados esto se logra a través de la automatización de tareas y utilización de nuevas tecnologías.</p>
<p>Economías de escala : En la teoría, se puede tener que la opción 2 tenga ventas similares o menores que la opción 3, esto podría lograrse en base a la optimización de procesos en las operaciones con el fin de aprovechar el concepto de economias de escala.</p>
<p>Se puede considerar viable que una opción tenga niveles más bajos en cuanto a tasas de incumplimiento y costos administrativos en relación con otra alternativa, basándose en las políticas internas, estrategias de gestión y características específicas del mercado objetivo. Se debe realizar un análisis profundo de las políticas y prácticas de cada opción con el fin de comprender plenamente las razones detrás de estas diferencias.</p>
</section>
<section id="referencias" class="level3">
<h3 class="anchored" data-anchor-id="referencias"><strong>Referencias</strong></h3>
<ul>
<li><p>Ahmad, A., &amp; N, A. (2018). <em>Comparison: Binomial model and Black Scholes model</em>. Web Of Science. https://www.webofscience.com/wos/woscc/full-record/WOS:000442608200008</p></li>
<li><p>Banco de Chile. (2022). <em>Memoria Anual 2022</em>. https://portales.bancochile.cl/uploads/000/045/680/42b47795-da00-472d-93c7-323ce640b28f/original/Memoria_BCH_2022_interactiva-Optimizada.pdf</p></li>
<li><p><em>Indicador de morosidad de 90 días o más individual del Sistema Bancario</em>. (2023, agosto). CMF. https://www.cmfchile.cl/portal/estadisticas/617/w3-propertyvalue-28914.html</p></li>
<li></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>